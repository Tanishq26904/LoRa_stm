/*
 * Mesh.c
 *
 *  Created on: Jan 24, 2026
 *      Author: 22142
 */
#include "Mesh.h"
#include "usart.h"
#include "gpio.h"

uint32_t lastActivityTime = 0;
uint32_t watchdogTimeout = 30000;

void reset_watchdog(void) {
    lastActivityTime = HAL_GetTick();
}

void check_watchdog(void) {
    if (HAL_GetTick() - lastActivityTime > watchdogTimeout) {
#ifdef USE_UART
        printu("ðŸ”„ Watchdog timeout - Resetting system\r\n");
#endif
        for (int i = 0; i < 5; i++) {
            HAL_GPIO_TogglePin(GPIOD, GPIO_PIN_2);
            HAL_Delay(100);
        }
        NVIC_SystemReset();
    }
}

